<!doctype html>
<html ‚ö°>
  <head>
    <title>Generate AMP Pages in Nuxt.js</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Irfan Maulana"><meta name="keywords" content="mazipan, mazipanneh, irfan maulana, irfan vue, irfan blibli, irfan bizzy"><meta name="theme-color" content="#bd93f9"><meta name="mobile-web-app-capable" content="yes"><meta property="og:image:width" content="512"><meta property="og:image:height" content="512"><meta property="og:site_name" content="@mazipan"><meta property="profile:username" content="mazipanneh"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@maz_ipan"><meta name="twitter:site" content="@maz_ipan"><meta name="description" content="How to generate AMP Pages for you blog using Nuxt.js"><meta name="apple-mobile-web-app-title" content="Generate AMP Pages in Nuxt.js"><meta property="og:title" content="Generate AMP Pages in Nuxt.js"><meta property="og:description" content="How to generate AMP Pages for you blog using Nuxt.js"><meta property="og:url" content="https://www.mazipan.xyz/generate-amp-pages-in-nuxtjs/en"><meta name="twitter:title" content="Generate AMP Pages in Nuxt.js"><meta name="twitter:description" content="How to generate AMP Pages for you blog using Nuxt.js"><meta name="twitter:url" content="https://www.mazipan.xyz/generate-amp-pages-in-nuxtjs/en"><meta property="og:image" content="https://www.mazipan.xyz/content-images/generate-amp-pages-in-nuxtjs/mazipan-amp.png"><meta property="og:image:secure_url" content="https://www.mazipan.xyz/content-images/generate-amp-pages-in-nuxtjs/mazipan-amp.png"><meta name="twitter:image:src" content="https://www.mazipan.xyz/content-images/generate-amp-pages-in-nuxtjs/mazipan-amp.png"><meta property="og:type" content="article"><meta property="article:published_time" content="2019-08-28T03:17:12.531Z"><meta property="article:section" content="Technology"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png"><link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png"><link rel="manifest" href="/_nuxt/manifest.c9c59db4.json"><link rel="shortcut icon" href="/_nuxt/icons/icon_64.b338d5.png"><link rel="apple-touch-icon" href="/_nuxt/icons/icon_512.b338d5.png" sizes="512x512"><link rel="canonical" href="https://www.mazipan.xyz/generate-amp-pages-in-nuxtjs/en">
    <link rel="preconnect" href="https://polyfill.io" crossorigin><link rel="dns-prefetch" href="https://polyfill.io">
    
  <style amp-custom>/*! modern-normalize | MIT License | https://github.com/sindresorhus/modern-normalize */html{-webkit-box-sizing:border-box;box-sizing:border-box}*,::after,::before{-webkit-box-sizing:inherit;box-sizing:inherit}:root{-moz-tab-size:4;-o-tab-size:4;tab-size:4}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol'}hr{height:0}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:SFMono-Regular,Consolas,'Liberation Mono',Menlo,Courier,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{padding:0}progress{vertical-align:baseline}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}:root{--bg:#282a36;--bgLighter:#44475a;--textNormal:#f8f8f2;--textTitle:#50fa7b;--textSubtitle:#8be9fd;--textLink:#bd93f9;--textHighlight:#ff79c6;--textWarning:#f1fa8c;--textDanger:#ff5555;--textSecondary:#6272a4}body{font-family:Montserrat,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-size:16px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;-webkit-box-sizing:border-box;box-sizing:border-box;color:var(--textNormal);background-color:var(--bg)}.container{margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem}.clearfix::after{content:"";clear:both;display:table}a{color:var(--textLink);text-decoration:none}a:hover{text-decoration:underline}blockquote{font-style:italic;border-left:4px solid var(--textSecondary);color:var(--textSecondary);margin:0;padding:.25em 1em;font-size:110%}small{font-size:80%}table{display:block;overflow:auto;width:100%;border-collapse:collapse;border-spacing:0}table th{border:1px solid #dfe2e5;padding:13px;font-weight:700}table tr td{border:1px solid #c6cbd1;padding:8px 13px;text-align:left}table tr:nth-child(2n){background-color:#3c3e50}:not(pre)>code[class*=language-],pre[class*=language-]{border-radius:10px;-webkit-box-shadow:0 0 8px 4px rgba(0,0,0,.2);box-shadow:0 0 8px 4px rgba(0,0,0,.2);background-color:var(--bgLighter)}code:not([class*=language-]){background-color:var(--bgLighter);color:var(--textLink);padding:.1em .5em;border-radius:.25em}pre{max-width:100%;overflow:auto}.flex{display:-webkit-box;display:-ms-flexbox;display:flex}.flex--center{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.dot{padding:0 .5em}.wrapper{margin:1em 0 0 0;min-height:60vh}.meta{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.meta__date{color:var(--textSubtitle)}@media screen and (max-width:640px){.meta--desktop{display:none}}.meta--mobile{display:none}@media screen and (max-width:640px){.meta--mobile{display:block}}.space-bottom{margin-bottom:1em}.footer{width:100%;margin:0 auto;text-align:center}@-webkit-keyframes zoomIn{from{opacity:0;-webkit-transform:scale3d(.3,.3,.3);transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes zoomIn{from{opacity:0;-webkit-transform:scale3d(.3,.3,.3);transform:scale3d(.3,.3,.3)}50%{opacity:1}}.zoomIn{-webkit-animation-name:zoomIn;animation-name:zoomIn;-webkit-animation-duration:1s;animation-duration:1s;-webkit-animation-fill-mode:both;animation-fill-mode:both}.text-normal{color:var(--textNormal)}.text-title{color:var(--textTitle)}.text-subtitle{color:var(--textSubtitle)}.text-link{color:var(--textLink)}.text-highlight{color:var(--textHighlight)}.text-warning{color:var(--textWarning)}.text-danger{color:var(--textDanger)}.text-secondary{color:var(--textSecondary)}.header{margin-bottom:3.5rem}.header--simplify{margin-bottom:1rem}.profile{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.profile--left{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.profile__img{height:76px;width:76px;margin-right:1em}.profile__text{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;margin-right:1em}.profile__title{font-weight:700;font-size:1.5em;margin-top:0}.profile__social a{margin-right:.5em}.nav{margin-top:1em}.pages__title{margin-bottom:.25em;font-weight:700}.pages__title--small{font-size:2em}.pages__cover{margin:2em 0 0 0;width:100%;height:200px;-o-object-fit:cover;object-fit:cover;border-radius:10px;-webkit-box-shadow:1px 1px 8px 5px rgba(0,0,0,.2);box-shadow:1px 1px 8px 5px rgba(0,0,0,.2)}.pages__content{width:100%;word-break:break-word;margin:2em 0}.pages__date{color:var(--textSubtitle)}.pages__item{margin-bottom:3.5em}.pages__lang{padding:.25em 1em;border-radius:.25em;background-color:var(--bgLighter);margin-bottom:1em;display:table;cursor:pointer}.pages__tags{display:-webkit-box;display:-ms-flexbox;display:flex}.pages__tags--spacetop{margin-top:.5em}.pages__tag{margin-right:.5em;padding:0 .5em;line-height:1.5;border-radius:.25em}.pages__tag a{color:var(--bgLighter)}.pages__tag:first-child{background-color:var(--textHighlight)}.pages__tag:nth-child(2){background-color:var(--textTitle)}.pages__tag:nth-child(3){background-color:var(--textSubtitle)}.pages__sponsored{padding:.25em 1em;border-radius:.25em;background-color:var(--bgLighter)}.pages__footer{margin:1em 0}.block-wrap{margin:1em 0;display:-webkit-box;display:-ms-flexbox;display:flex;justify-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.like,.share{display:-webkit-box;display:-ms-flexbox;display:flex}.like-btn,.share-btn{color:var(--textNormal);background:var(--textLink);padding:.25em 1em;border-radius:.25em;border:0;outline:0;cursor:pointer;margin-right:1em;text-decoration:none;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.pages__content h2{color:var(--textSubtitle)}.pages__content h3{color:var(--textWarning)}.pages__content a{color:var(--textHighlight);text-decoration:underline}.pages__content p{line-height:1.5}.pages__content img{width:90%;height:auto;border-radius:10px;-webkit-box-shadow:1px 1px 8px 5px rgba(0,0,0,.2);box-shadow:1px 1px 8px 5px rgba(0,0,0,.2);-o-object-fit:cover;object-fit:cover}.pages__content ol>li,.pages__content ul{line-height:2}.VueAdsense{margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem;border-radius:10px;-webkit-box-shadow:1px 1px 8px 5px rgba(0,0,0,.2);box-shadow:1px 1px 8px 5px rgba(0,0,0,.2)}.ion{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.ion__svg{fill:currentColor}@-webkit-keyframes ionShake{10%,90%{-webkit-transform:translate3d(-1px,0,0);transform:translate3d(-1px,0,0)}20%,80%{-webkit-transform:translate3d(2px,0,0);transform:translate3d(2px,0,0)}30%,50%,70%{-webkit-transform:translate3d(-4px,0,0);transform:translate3d(-4px,0,0)}40%,60%{-webkit-transform:translate3d(4px,0,0);transform:translate3d(4px,0,0)}}@keyframes ionShake{10%,90%{-webkit-transform:translate3d(-1px,0,0);transform:translate3d(-1px,0,0)}20%,80%{-webkit-transform:translate3d(2px,0,0);transform:translate3d(2px,0,0)}30%,50%,70%{-webkit-transform:translate3d(-4px,0,0);transform:translate3d(-4px,0,0)}40%,60%{-webkit-transform:translate3d(4px,0,0);transform:translate3d(4px,0,0)}}@-webkit-keyframes ionRotate{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes ionRotate{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes ionBeat{0%{-webkit-transform:scale(.75);transform:scale(.75)}20%{-webkit-transform:scale(1);transform:scale(1)}40%{-webkit-transform:scale(.75);transform:scale(.75)}60%{-webkit-transform:scale(1);transform:scale(1)}80%{-webkit-transform:scale(.75);transform:scale(.75)}100%{-webkit-transform:scale(.75);transform:scale(.75)}}@keyframes ionBeat{0%{-webkit-transform:scale(.75);transform:scale(.75)}20%{-webkit-transform:scale(1);transform:scale(1)}40%{-webkit-transform:scale(.75);transform:scale(.75)}60%{-webkit-transform:scale(1);transform:scale(1)}80%{-webkit-transform:scale(.75);transform:scale(.75)}100%{-webkit-transform:scale(.75);transform:scale(.75)}}.ion-beat{-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-name:ionBeat;animation-name:ionBeat;-webkit-animation-duration:.82s;animation-duration:.82s}.ion-shake{-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-name:ionShake;animation-name:ionShake;-webkit-animation-duration:.82s;animation-duration:.82s}.ion-rotate{-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-name:ionRotate;animation-name:ionRotate;-webkit-animation-duration:2s;animation-duration:2s}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:4px;width:0%;opacity:1;-webkit-transition:width .1s,opacity .4s;transition:width .1s,opacity .4s;background-color:#bd93f9;z-index:999999}.nuxt-progress.nuxt-progress-notransition{-webkit-transition:none;transition:none}.nuxt-progress-failed{background-color:red}</style><script async src="https://cdn.ampproject.org/v0.js"></script>
<script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
<script async custom-element="amp-auto-ads" src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js"></script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript></head>
  <body>
    <div id="__nuxt"><!----><div id="__layout"><div class="container app"><header class="header header--simplify clearfix"><div class="header__block"><div class="header__child"><a href="/amp/" class="nuxt-link-active"><h1 class="h1">
          mazipan.xyz
        </h1></a> <div class="nav--wrapper navigation"><div class="nav">
    üòé
    <a href="/amp/about">
      About
    </a> <span class="dot"> ‚Ä¢ </span>
    ‚è∞
    <a href="/amp/now">
      Now
    </a></div> <div class="nav">
    üì¶
    <a href="/amp/archives">
      Archives
    </a> <span class="dot"> ‚Ä¢ </span>
    üòà
    <a href="/amp/ghibahprogrammer">
      Ghibah
    </a></div></div></div></div></header> <section class="postdetail-EN wrapper clearfix"><section class="pages"><h1 class="pages__title pages__title--small text-title">
    Generate AMP Pages in Nuxt.js
  </h1> <!----> <div class="pages__lang"><a href="/amp/generate-amp-pages-in-nuxtjs/?utm_source=lang">
      Switch to  üáÆüá© language
    </a></div> <div><div class="meta meta--desktop"><small class="meta__date">
      üìÜ June 2, 2019
    </small> <small class="dot"> ‚Ä¢ </small> <small class="meta__read">‚òïÔ∏è‚òïÔ∏è 20 min read</small> <!----> <!----> <!----> <!----></div> <div class="meta meta--mobile"><div><small class="meta__date">
        üìÜ June 2, 2019
      </small> <small class="dot"> ‚Ä¢ </small> <small class="meta__read">‚òïÔ∏è‚òïÔ∏è 20 min read</small></div> <div style="margin-top:.5em"><!----> <!----> <!----></div></div></div> <div class="pages__tags pages__tags--spacetop"><div class="pages__tag"><a href="/category/javascript?utm_source=home" title="javascript">
        #javascript
      </a></div><div class="pages__tag"><a href="/category/nuxt?utm_source=home" title="nuxt">
        #nuxt
      </a></div><div class="pages__tag"><a href="/category/amp?utm_source=home" title="amp">
        #amp
      </a></div></div> <div class="pages__content"><div class="content-markdown"><h2>About AMP</h2> <p>AMP (Accelerated Mobile Pages - <a href="https://amp.dev">amp.dev ‚ÜóÔ∏è</a>) is Google's iniisatif for helping publishers, developers and website owner to serve website with fast first load time even nearly instant in mobile devices. For achieving that instant loading is not free, this can be done by AMP with applying so many strict rule for websites. We can say that AMP is strip down all your custom JavaScript to guarantee your website have instant load time.</p> <p>AMP is recommended by Google because it is very user centrict. Google also will prioritize the contents with AMP support with adding a badge in the search results to indicate AMP. Google also support with adding the caches to boost the first load speed into the limit which make AMP is the best choice for first user landing from the search result.</p> <amp-img  src="/content-images/generate-amp-pages-in-nuxtjs/mazipan-amp.png" alt="Mazipan AMP" height="200px" width="200px" layout=responsive></amp-img> <h2>Basics for Creating AMP</h2> <p>AMP is seperate pages with the normal one. This is because AMP have different strict rule that make us harder to implement in our existing technology stack that usually become very depends on JavaScript.</p> <p>For creating new AMP pages, first we need to add an identifier in <code>html</code> tag to make browser know that the pages is AMP version.</p> <p>If in normal HTML we can have this below code:</p> <pre><code class="language-html">&lt;html>
  &lt;head>&lt;/head>
  &lt;body>&lt;/body>
&lt;html>
</code></pre> <p>In AMP we will add emoji ‚ö° in our <code>html</code> tag, see below example:</p> <pre><code class="language-html">&lt;html ‚ö°>
  &lt;head>&lt;/head>
  &lt;body>&lt;/body>
&lt;html>
</code></pre> <p>Or we can just change the ‚ö° emoji with attribute <code>amp</code> without any values if we didn't support emoji.</p> <p>After adding the identifier, we need to add the main AMP engine script with this below code:</p> <pre><code class="language-html">&lt;script async src="https://cdn.ampproject.org/v0.js">&lt;/script>
</code></pre> <p>We also need to add CSS boilerplate for all AMP pages:</p> <pre><code class="language-html">&lt;style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}&lt;/style>&lt;noscript>&lt;style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}&lt;/style>&lt;/noscript>
</code></pre> <p>The things we need to be noted is AMP is not allowing any custom JavaScript or any external third party JavaScript link.</p> <p>So do with CSS file, we can't load any external CSS file. All style need to be loaded internally using tag <code>amp-custom</code> like below example code:</p> <pre><code class="language-html">&lt;style amp-custom>
  .custom-class {}
&lt;/style>
</code></pre> <p>In AMP, we can use any <code></code> in our CSS code.</p> <p>Basically, we can use any HTML tag inside our <code>&lt;body></code> tag. But AMP already creating many components to help us in creating a common layout or functionality. Better for us to read in <a href="https://amp.dev/documentation/components/?format=websites">AMPs official documentations</a> about the components that already created by AMP teams so we can have better visibility when creating AMP pages in the future.</p> <h2>Generate AMP in Nuxt.js</h2> <p>Creating AMP pages in JavaScript framework was like an impossible things to do. This is because JavaScript is forbidden in AMP, while in JavaScript framework become the main technology to be used.</p> <p>Today, JavaScript framework already have power to generate static pages like Nuxt.js already done. In my blog itself, I use Nuxt.js for generate static pages to simplify my deployment process. Unfortunately, the static files that generated bu Nuxt.js is bloated with many external JavaScript that need to be clean up first. So the hardest task to generate AMP in Nuxt.js is cleaning process itself.</p> <p>These are steps that I have been done in generate AMP for my blog:</p> <h3>1. Creating new pages</h3> <p>First of all, I need to create new pages under the same root url <code>/amp/**</code> with nearly same content with the normal pages. This is for helping us to differentiate AMP pages with the normal pages so we can running clean up process is only for AMP pages an skip the normal pages.</p> <h3>2. Remove unused codes</h3> <p>Because AMP is not allowing any custom JavaScript actions, so any codes in our AMP pages which placed under <code>methods</code> in Vue's single file components file are need to be removed. This code become unused because we need to strip down all interactions that require any custom Javascript.</p> <h3>3. Adding hooks in generate</h3> <p>I use <code>generate</code> command in Nuxt.js to creating static files for my blog so I need to add hooks to detect when this command is executed. In Nuxt, this task can be done with adding this below code in <code>nuxt.config.js</code> file like this below example:</p> <pre><code class="language-javascript">module.exports = {
  hooks: {
    'generate:page': (page) => {
      if (/^\/amp/gi.test(page.route)) {
        console.log('processing amp file: ', page.route)
      }
    }
  },
}
</code></pre> <p>The code above is for inserting a process when Nuxt execute command <code>generate</code> and we adding <em>Regular Expressions</em> to detect only the AMP pages route that have added process and skip all the normal pages.</p> <h3>4. Manipulate HTML output</h3> <p>From our sample code above, we have <code>page</code> object as parameter in our generate hooks. If we get property <code>page.html</code> we can get the HTML string as our final output as HTML file.</p> <p>The good thing from Internet is there are many good people there. I found the article from <a href="https://toor.co/blog/amp-pages-using-nuxt-js/">toor.co ‚ÜóÔ∏è</a> that share about cleaning up HTML string from Nuxt to support AMP.</p> <p>We can just copy-paste this below code:</p> <pre><code class="language-javascript">const ampScript = '&lt;script async src="https://cdn.ampproject.org/v0.js">&lt;/script>'
const ampBoilerplate = '&lt;style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}&lt;/style>&lt;noscript>&lt;style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}&lt;/style>&lt;/noscript>'

module.exports = (html) => {
  // Add ‚ö° to html tag
  html = html.replace(/&lt;html/gi, '&lt;html ‚ö°')

  // Combine css into single tag
  let styleConcat = ''
  html = html.replace(/&lt;style[^>]*>]*>(.*?)?&lt;\/style>/gi, (match, sub) => {
    styleConcat += sub
    return ''
  })
  html = html.replace('&lt;/head>', `&lt;style amp-custom>${styleConcat}&lt;/style>&lt;/head>`)

  // Remove preload and prefetch tags
  html = html.replace(/&lt;link[^>]*rel="(?:preload|prefetch)?"[^>]*>/gi, '')

  // Remove amphtml tag
  html = html.replace(/&lt;link[^>]*rel="(?:amphtml)?"[^>]*>/gi, '')

  // Remove data attributes from tags
  html = html.replace(/\s*=>]*="[^"]*"|[^=>\s]*)/gi, '')

  // Remove JS script tags except for ld+json
  html = html.replace(/&lt;script\b[^&lt;]*(?:(?!&lt;\/script>)&lt;[^&lt;]*)*&lt;\/script>/gi, (match) => {
    return (/application\/ld\+json/gi.test(match)) ? match : ''
  })

  // Replace img tags with amp-img
  html = html.replace(/&lt;img([^>]*)>/gi, (match, sub) => {
    return `&lt;amp-img ${sub} layout=intrinsic>&lt;/amp-img>`
  })

  // Add AMP script before &lt;/head>
  html = html.replace('&lt;/head>', ampScript + ampBoilerplate + '&lt;/head>')

  return html
}
</code></pre> <p>You can check the detail of each process with reading the comments in that code. Basically we just <em>replace</em> the characters we didn't need with <em>RegEx</em> and adding AMP support script. We adding emoji ‚ö°, remove all external JavaScript, combine all internal CSS into one tag under <code>&lt;style amp-custom></code> and any other tasks.</p> <p>This functions is put in <code>plugins/ampify.js</code> directory that will be called in generate hook generate like this below sample:</p> <pre><code class="language-javascript">const ampify = require('./plugins/ampify')

module.exports = {
  hooks: {
    'generate:page': (page) => {
      if (/^\/amp/gi.test(page.route)) {
        console.log('processing amp file: ', page.route)
        page.html = ampify(page.html)
      }
    }
  },
}
</code></pre> <h3>5. Change all scoped style to global style</h3> <p>Because I am not good enough to playing with <em>RegEx</em> code, it's very risky to update the RegEx when something unexpected happened.</p> <p>And I realize that this below code make weird result:</p> <pre><code class="language-javascript">// Remove data attributes from tags
html = html.replace(/\s*=>]*="[^"]*"|[^=>\s]*)/gi, '')
</code></pre> <p>The above code made all my scoped style become invalid because wrong replace process. The easiest part for me to solve this thing is move all scoped style into global style. But this task can be done easily because with unscoped style I need to apply CSS module architecture to keep the CSS from one components is not affecting any other component. I prefer use BEM CSS because of my experience of using this CSS convention.</p> <p>This step is optional for you if you can update the Regex part that made weird replace process.</p> <h3>6. Change all lazy load images</h3> <p>In non-AMP pages, I use <a href="https://github.com/mazipan/vue-tiny-lazyload-img">VueTinyLazyloadImg ‚ÜóÔ∏è</a> library to creating lazy load image. For AMP we don't need this library anymore because amp have <code>amp-img</code> component that already support lazy load by default.</p> <p>Using <code>amp-img</code> make my existing function in lazy load become invalid for AMP because with in existing function I put attribut <code>> to load the original source of image and using <code>src</code> for placeholder image. This thing need to be adjust for AMP with replacing <code>> attribute with <code>src</code> and delete placeholder image.</p> <p>You can see the RegEX function in this below sample:</p> <pre><code class="language-javascript">function replaceLazyloadImg (str) {
  return str && str.replace(/"src":(?:[^=>][^"]*","=>"]*)/gi, '"src"')
}
</code></pre> <h3>7. Adding fix size for images</h3> <p>This is the step that I haven't done when this article published. All the image tag should have <code>height</code> and <code>width</code> attribute.</p> <h3>8. Adding canonical</h3> <p>We need to linking our AMP with each respective normal pages that have same content with our AMP.</p> <p>You can put link canonical under <code>&lt;head></code> tag in AMP page like in this below code :</p> <pre><code class="language-html">&lt;head>
  &lt;link rel="canonical" href="url-to-normal-page">&lt;/link>
&lt;/head>
</code></pre> <p>In our normal page we can add <code>amphtml</code> link, see this below code:</p> <pre><code class="language-html">&lt;link rel="amphtml" href="url-to-amp-page">&lt;/link>
</code></pre> <p>In Nuxt.js, we can add this meta tag via <code>head()</code> in our .vue files, see this below sample:</p> <pre><code class="language-javascript">export default {
  head () {
    const url = `${this.productionUrl}/${this.meta.slug}`
    return {
      link: [
        { hid: 'canonical', rel: 'canonical', href: url }
      ]
    }
  }
}
</code></pre> <p>And this below code is sample to insert tag <code>amphtml</code> in normal page:</p> <pre><code class="language-javascript">export default {
  head () {
    const ampUrl = `${this.productionUrl}/amp/${this.meta.slug}`
    return {
      link: [
        { hid: 'amphtml', rel: 'amphtml', href: ampUrl }
      ]
    }
  }
}
</code></pre> <h3>9. Adding Google Analytics</h3> <p>Adding Google Analytics in AMP is quite different with the normal page. In short, we just need to add this below script to adding Google Analytics engine in our AMP pages:</p> <pre><code class="language-html">&lt;script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js">&lt;/script>
</code></pre> <p>Also placing this below simple tracker to tracking page view state:</p> <pre><code class="language-html">&lt;amp-analytics type='googleanalytics'>
  &lt;script type='application/json'>
    {
      "vars": {
        "account": "UA-12345678-X"
      },
      "triggers": {
        "trackPageview": {
          "on": "visible",
          "request": "pageview"
        }
      }
    }
  &lt;/script>
&lt;/amp-analytics>
</code></pre> <p>I update the <code>ampify</code> script to insert analytics into our AMP pages:</p> <pre><code class="language-javascript">const ampScript = `&lt;script async src="https://cdn.ampproject.org/v0.js">&lt;/script>
&lt;script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js">&lt;/script>`
</code></pre> <p>We also insert page view tracker before close tag <code>&lt;/body></code> like this below code:</p> <pre><code class="language-javascript">// Add AMP analytics
html = html.replace('&lt;/body>',
`&lt;amp-analytics type='googleanalytics'>
    &lt;script type='application/json'>
      {
        "vars": {
          "account": "UA-12345678-X"
        },
        "triggers": {
          "trackPageview": {
            "on": "visible",
            "request": "pageview"
          }
        }
      }
    &lt;/script>
  &lt;/amp-analytics>
&lt;/body>`)
</code></pre> <h2>Validate AMP Pages</h2> <p>Not all AMP can be shown in Google Search result, only the valid pages that can have badge in search result. So we need to test the validity first before publishing our AMP pages. There are some alternatives outside to test AMP validation, two website that I can mention are:</p> <ul><li><a href="https://search.google.com/test/amp">https://search.google.com/test/amp</a></li> <li><a href="https://validator.ampproject.org/">https://validator.ampproject.org/</a></li></ul> <p>For my blog itself, you can see the test results in below list:</p> <ul><li><a href="https://search.google.com/test/amp?url=https%3A%2F%2Fwww.mazipan.xyz%2Famp">Homepage</a></li> <li><a href="https://search.google.com/test/amp?url=https%3A%2F%2Fwww.mazipan.xyz%2Famp%2Fabout">About Page</a></li> <li><a href="https://search.google.com/test/amp?url=https%3A%2F%2Fwww.mazipan.xyz%2Famp%2Feslint-formatter-html-extended%2F">Article Page - without any images</a></li> <li><a href="https://search.google.com/test/amp?url=https%3A%2F%2Fwww.mazipan.xyz%2Famp%2Ftasting-reasonml-for-react%2F">Article Page - with images</a></li></ul> <h2>Github Repo</h2> <p><a href="https://github.com/mazipan/blog-2.0">https://github.com/mazipan/blog-2.0 ‚ÜóÔ∏è</a></p> <h3>Hopefully useful...</h3></div> <div><a href="/" class="nuxt-link-active">
    üè† Back to Home
  </a> <span class="dot"> ‚Ä¢ </span> <a target="_blank" rel="noopener" title="Edit in Github" href="https://github.com/mazipan/blog-2.0/edit/master/contents/published/generate-amp-pages-in-nuxtjs/index.md">
    üìù Edit in Github
  </a></div></div> <hr> <div class="pages__footer">
    üö®Do you like this article? help me to share to your followers.
  </div> <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://www.mazipan.xyz"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "javascript",
      "item": "https://www.mazipan.xyz/category/javascript"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Generate AMP Pages in Nuxt.js",
      "item": "https://www.mazipan.xyz/generate-amp-pages-in-nuxtjs"
    }
  ]
}</script> <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.mazipan.xyz/generate-amp-pages-in-nuxtjs"
  },
  "headline": "Generate AMP Pages in Nuxt.js",
  "image": [
    "https://www.mazipan.xyz/content-images/generate-amp-pages-in-nuxtjs/mazipan-amp.png"
  ],
  "datePublished": "2019-06-02T00:00:00.000Z",
  "dateModified": "2019-06-02T00:00:00.000Z",
  "author": {
    "@type": "Person",
    "name": "Irfan Maulana"
  },
  "publisher": {
    "@type": "Organization",
    "name": "mazipan",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.mazipan.xyz/favicon-192x192.png"
    }
  },
  "description": "How to generate AMP Pages for you blog using Nuxt.js"
}</script></section></section> <hr> <footer class="footer clearfix"><span>Copyright ¬© 2019 by</span> <a href="http://github.com/mazipan" title="Github" target="_blank" rel="noopener">Irfan Maulana</a> <br> <br> <div class="profile__social"><a href="https://github.com/mazipan" title="Github" target="_blank" rel="noopener"><svg viewBox="0 0 512 512" width="24px" height="24px" class="ion__svg"><path d="M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9 1.4.3 2.6.4 3.8.4 8.3 0 11.5-6.1 11.5-11.4 0-5.5-.2-19.9-.3-39.1-8.4 1.9-15.9 2.7-22.6 2.7-43.1 0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8 11.2 19.6 26.2 25.1 39.6 25.1 10.5 0 20-3.4 25.6-6 2-14.8 7.8-24.9 14.2-30.7-49.7-5.8-102-25.5-102-113.5 0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8 0 0 1.6-.5 5-.5 8.1 0 26.4 3.1 56.6 24.1 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 30.2-21 48.5-24.1 56.6-24.1 3.4 0 5 .5 5 .5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6 0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5 0 30.7-.3 55.5-.3 63 0 5.4 3.1 11.5 11.4 11.5 1.2 0 2.6-.1 4-.4C415.9 449.2 480 363.1 480 261.7 480 134.9 379.7 32 256 32z"></path></svg></a> <a href="https://twitter.com/Maz_Ipan" title="Twitter" target="_blank" rel="noopener"><svg viewBox="0 0 512 512" width="24px" height="24px" class="ion__svg"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6-18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6.8 15 2.5 22.1-80.5-4-151.9-42.6-199.6-101.3-8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7-16-.4-31-4.8-44-12.1v1.2c0 47 33.4 86.1 77.7 95-8.1 2.2-16.7 3.4-25.5 3.4-6.2 0-12.3-.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3-33.1 26-74.9 41.5-120.3 41.5-7.8 0-15.5-.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-.1-8.4-.3-12.5C462.6 146 479 129 492 109.5z"></path></svg></a> <a href="https://www.facebook.com/mazipanneh" title="Facebook" target="_blank" rel="noopener"><svg width="24px" height="24px" viewBox="0 0 512 512" class="ion__svg"><path d="M426.8 64H85.2C73.5 64 64 73.5 64 85.2v341.6c0 11.7 9.5 21.2 21.2 21.2H256V296h-45.9v-56H256v-41.4c0-49.6 34.4-76.6 78.7-76.6 21.2 0 44 1.6 49.3 2.3v51.8h-35.3c-24.1 0-28.7 11.4-28.7 28.2V240h57.4l-7.5 56H320v152h106.8c11.7 0 21.2-9.5 21.2-21.2V85.2c0-11.7-9.5-21.2-21.2-21.2z"></path></svg></a></div></footer></div></div></div><noscript>This website requires JavaScript.</noscript>
    <script type="application/ld+json">{"@context": "http://schema.org","@type": "WebSite","url": "https://www.mazipan.xyz", "name": "Irfan Maulana", "author": "Irfan Maulana", "image": "https://www.mazipan.xyz/icon.png", "description": "@mazipan | A personal blog by Irfan Maulana", "sameAs": [ "https://www.facebook.com/mazipanneh", "https://instagram.com/maz_ipan", "https://twitter.com/Maz_Ipan", "https://id.linkedin.com/in/mazipan", "https://www.slideshare.net/IrfanMaulana21", "https://github.com/mazipan"]}</script>
  
    <amp-auto-ads type="adsense" data-ad-client="ca-pub-5442972248172818"></amp-auto-ads>
    <amp-analytics type='googleanalytics'>
    <script type='application/json'>
      {
        "vars": {
          "account": "UA-25065548-6"
        },
        "triggers": {
          "trackPageview": {
            "on": "visible",
            "request": "pageview"
          }
        }
      }
    </script>
  </amp-analytics>
</body>
</html>
